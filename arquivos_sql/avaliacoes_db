-- MySQL Script generated by MySQL Workbench
-- qui 07 nov 2024 05:57:29
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema avaliacoes_db
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema avaliacoes_db
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `avaliacoes_db` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ;
USE `avaliacoes_db` ;

-- -----------------------------------------------------
-- Table `avaliacoes_db`.`business_unities`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`business_unities` (
  `id_bu` INT NOT NULL,
  `nome_bu` VARCHAR(100) NOT NULL,
  `csat_bu` DECIMAL(5,2) NULL DEFAULT NULL,
  PRIMARY KEY (`id_bu`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_business_unities_csat_bu` ON `avaliacoes_db`.`business_unities` (`csat_bu` ASC) VISIBLE;

CREATE INDEX `idx_business_unities_nome_bu` ON `avaliacoes_db`.`business_unities` (`nome_bu` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`projetos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`projetos` (
  `id_projeto` INT NOT NULL,
  `nome_projeto` VARCHAR(100) NOT NULL,
  `csat_projeto` DECIMAL(5,2) NULL DEFAULT NULL,
  `id_bu` INT NOT NULL,
  PRIMARY KEY (`id_projeto`),
  CONSTRAINT `fk_projetos_id_bu`
    FOREIGN KEY (`id_bu`)
    REFERENCES `avaliacoes_db`.`business_unities` (`id_bu`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_projetos_id_bu` ON `avaliacoes_db`.`projetos` (`id_bu` ASC) VISIBLE;

CREATE INDEX `idx_projetos_csat_projeto` ON `avaliacoes_db`.`projetos` (`csat_projeto` ASC) VISIBLE;

CREATE INDEX `idx_projetos_idbu_idprojeto` ON `avaliacoes_db`.`projetos` (`id_bu` ASC, `id_projeto` ASC) VISIBLE;

CREATE INDEX `idx_projetos_nome_projeto` ON `avaliacoes_db`.`projetos` (`nome_projeto` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`checklists`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`checklists` (
  `id_checklist` INT NOT NULL,
  `nome_checklist` VARCHAR(100) NOT NULL,
  `id_projeto` INT NOT NULL,
  `csat_checklist` DECIMAL(5,2) NULL DEFAULT NULL,
  `total_entregaveis` INT NULL DEFAULT '0',
  PRIMARY KEY (`id_checklist`),
  CONSTRAINT `checklists_ibfk_1`
    FOREIGN KEY (`id_projeto`)
    REFERENCES `avaliacoes_db`.`projetos` (`id_projeto`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_checklists_projeto` ON `avaliacoes_db`.`checklists` (`id_projeto` ASC) VISIBLE;

CREATE INDEX `idx_checklists_csat_checklist` ON `avaliacoes_db`.`checklists` (`csat_checklist` ASC) VISIBLE;

CREATE INDEX `idx_checklists_idprojeto_idchecklist` ON `avaliacoes_db`.`checklists` (`id_projeto` ASC, `id_checklist` ASC) VISIBLE;

CREATE INDEX `idx_checklists_nome_checklist` ON `avaliacoes_db`.`checklists` (`nome_checklist` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`avaliacoes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`avaliacoes` (
  `id_avaliacao` INT NOT NULL,
  `id_checklist` INT NOT NULL,
  `data_avaliacao` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `tipo_avaliacao` VARCHAR(50) NOT NULL,
  `csat_avaliacao` DECIMAL(5,2) NULL DEFAULT NULL,
  `total_entregaveis` INT NULL DEFAULT '0',
  `total_participantes` INT NULL DEFAULT '0',
  `status` ENUM('Backlog', 'Em andamento', 'Encerrada') NULL DEFAULT 'Backlog',
  `csat_conteudo` DECIMAL(5,2) NULL DEFAULT NULL,
  `csat_consultor` DECIMAL(5,2) NULL DEFAULT NULL,
  `csat_evento` DECIMAL(5,2) NULL DEFAULT NULL,
  `nps_avaliacao` DECIMAL(5,2) NOT NULL,
  PRIMARY KEY (`id_avaliacao`),
  CONSTRAINT `avaliacoes_ibfk_1`
    FOREIGN KEY (`id_checklist`)
    REFERENCES `avaliacoes_db`.`checklists` (`id_checklist`),
  CONSTRAINT `avaliacoes_ibfk_2`
    FOREIGN KEY (`id_checklist`)
    REFERENCES `avaliacoes_db`.`checklists` (`id_checklist`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_avaliacoes_checklist` ON `avaliacoes_db`.`avaliacoes` (`id_checklist` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_status` ON `avaliacoes_db`.`avaliacoes` (`status` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_csat_avaliacao` ON `avaliacoes_db`.`avaliacoes` (`csat_avaliacao` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_idchecklist_idavaliacao` ON `avaliacoes_db`.`avaliacoes` (`id_checklist` ASC, `id_avaliacao` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_nps_avaliacao` ON `avaliacoes_db`.`avaliacoes` (`nps_avaliacao` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_csat_conteudo` ON `avaliacoes_db`.`avaliacoes` (`csat_conteudo` ASC) VISIBLE;

CREATE INDEX `idx_avaliacoes_csat_evento` ON `avaliacoes_db`.`avaliacoes` (`csat_evento` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`clientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`clientes` (
  `id_cliente` INT NOT NULL,
  `nome_cliente` VARCHAR(100) NOT NULL,
  `id_bu` INT NOT NULL,
  `csat_cliente` DECIMAL(5,2) NULL DEFAULT NULL,
  PRIMARY KEY (`id_cliente`),
  CONSTRAINT `clientes_ibfk_1`
    FOREIGN KEY (`id_bu`)
    REFERENCES `avaliacoes_db`.`business_unities` (`id_bu`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_clientes_csat_cliente` ON `avaliacoes_db`.`clientes` (`csat_cliente` ASC) VISIBLE;

CREATE INDEX `idx_clientes_id_bu` ON `avaliacoes_db`.`clientes` (`id_bu` ASC) VISIBLE;

CREATE INDEX `idx_clientes_nome_cliente` ON `avaliacoes_db`.`clientes` (`nome_cliente` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`clientes_projetos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`clientes_projetos` (
  `id_cliente` INT NOT NULL,
  `id_projeto` INT NOT NULL,
  PRIMARY KEY (`id_cliente`, `id_projeto`),
  CONSTRAINT `clientes_projetos_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `avaliacoes_db`.`clientes` (`id_cliente`),
  CONSTRAINT `clientes_projetos_ibfk_2`
    FOREIGN KEY (`id_projeto`)
    REFERENCES `avaliacoes_db`.`projetos` (`id_projeto`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_clientes_projetos_idcliente_idprojeto` ON `avaliacoes_db`.`clientes_projetos` (`id_cliente` ASC, `id_projeto` ASC) VISIBLE;

CREATE INDEX `idx_clientes_projetos_cliente` ON `avaliacoes_db`.`clientes_projetos` (`id_cliente` ASC) VISIBLE;

CREATE INDEX `idx_clientes_projetos_projeto` ON `avaliacoes_db`.`clientes_projetos` (`id_projeto` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`entregaveis`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`entregaveis` (
  `id_entregavel` VARCHAR(255) NOT NULL,
  `id_avaliacao` INT NOT NULL,
  `data_recebimento` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `csat_entregavel` DECIMAL(5,2) NULL DEFAULT NULL,
  `id_typeform` VARCHAR(50) NULL DEFAULT NULL,
  `nome_respondente` VARCHAR(100) NULL DEFAULT NULL,
  `nps` DECIMAL(5,2) NOT NULL,
  `csat_conteudo` DECIMAL(5,2) NULL DEFAULT NULL,
  `csat_consultor` DECIMAL(5,2) NULL DEFAULT NULL,
  `csat_evento` DECIMAL(5,2) NULL DEFAULT NULL,
  PRIMARY KEY (`id_entregavel`),
  CONSTRAINT `entregaveis_ibfk_1`
    FOREIGN KEY (`id_avaliacao`)
    REFERENCES `avaliacoes_db`.`avaliacoes` (`id_avaliacao`),
  CONSTRAINT `entregaveis_ibfk_2`
    FOREIGN KEY (`id_avaliacao`)
    REFERENCES `avaliacoes_db`.`avaliacoes` (`id_avaliacao`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_entregaveis_idavaliacao_identregavel` ON `avaliacoes_db`.`entregaveis` (`id_avaliacao` ASC, `id_entregavel` ASC) VISIBLE;

CREATE INDEX `idx_entregaveis_nps` ON `avaliacoes_db`.`entregaveis` (`nps` ASC) VISIBLE;

CREATE INDEX `idx_entregaveis_csat_conteudo` ON `avaliacoes_db`.`entregaveis` (`csat_conteudo` ASC) VISIBLE;

CREATE INDEX `idx_entregaveis_csat_evento` ON `avaliacoes_db`.`entregaveis` (`csat_evento` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`perguntas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`perguntas` (
  `id_pergunta` VARCHAR(50) NOT NULL,
  `id_avaliacao` INT NOT NULL,
  `texto_pergunta` VARCHAR(255) NOT NULL,
  `tipo_pergunta` VARCHAR(50) NOT NULL,
  `ordem` INT NOT NULL,
  `opcional` TINYINT(1) NULL DEFAULT '0',
  PRIMARY KEY (`id_pergunta`, `id_avaliacao`),
  CONSTRAINT `perguntas_ibfk_1`
    FOREIGN KEY (`id_avaliacao`)
    REFERENCES `avaliacoes_db`.`avaliacoes` (`id_avaliacao`),
  CONSTRAINT `perguntas_ibfk_2`
    FOREIGN KEY (`id_avaliacao`)
    REFERENCES `avaliacoes_db`.`avaliacoes` (`id_avaliacao`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_perguntas_avaliacao` ON `avaliacoes_db`.`perguntas` (`id_avaliacao` ASC) VISIBLE;

CREATE INDEX `idx_perguntas_idavaliacao_idpergunta` ON `avaliacoes_db`.`perguntas` (`id_avaliacao` ASC, `id_pergunta` ASC) VISIBLE;

CREATE INDEX `idx_perguntas_tipo_pergunta` ON `avaliacoes_db`.`perguntas` (`tipo_pergunta` ASC) VISIBLE;

CREATE INDEX `idx_perguntas_tipo_id` ON `avaliacoes_db`.`perguntas` (`tipo_pergunta` ASC, `id_pergunta` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `avaliacoes_db`.`respostas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `avaliacoes_db`.`respostas` (
  `id_resposta` INT NOT NULL AUTO_INCREMENT,
  `id_entregavel` VARCHAR(255) NOT NULL,
  `id_pergunta` VARCHAR(50) NOT NULL,
  `id_avaliacao` INT NOT NULL,
  `valor_resposta` DECIMAL(5,2) NULL DEFAULT NULL,
  `texto_resposta` VARCHAR(500) NULL DEFAULT NULL,
  `tipo_resposta` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`id_resposta`),
  CONSTRAINT `respostas_ibfk_1`
    FOREIGN KEY (`id_entregavel`)
    REFERENCES `avaliacoes_db`.`entregaveis` (`id_entregavel`),
  CONSTRAINT `respostas_ibfk_2`
    FOREIGN KEY (`id_pergunta` , `id_avaliacao`)
    REFERENCES `avaliacoes_db`.`perguntas` (`id_pergunta` , `id_avaliacao`))
ENGINE = InnoDB
AUTO_INCREMENT = 17
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_unicode_ci;

CREATE INDEX `idx_respostas_entregavel` ON `avaliacoes_db`.`respostas` (`id_entregavel` ASC) VISIBLE;

CREATE INDEX `idx_respostas_pergunta` ON `avaliacoes_db`.`respostas` (`id_pergunta` ASC) VISIBLE;

CREATE INDEX `idx_respostas_pergunta_avaliacao` ON `avaliacoes_db`.`respostas` (`id_pergunta` ASC, `id_avaliacao` ASC) VISIBLE;

CREATE INDEX `idx_respostas_idavaliacao_idpergunta` ON `avaliacoes_db`.`respostas` (`id_avaliacao` ASC, `id_pergunta` ASC) VISIBLE;

CREATE INDEX `idx_respostas_identregavel_idpergunta` ON `avaliacoes_db`.`respostas` (`id_entregavel` ASC, `id_pergunta` ASC) VISIBLE;

CREATE INDEX `idx_respostas_idavaliacao_identregavel` ON `avaliacoes_db`.`respostas` (`id_avaliacao` ASC, `id_entregavel` ASC) VISIBLE;

CREATE INDEX `idx_respostas_valor_resposta` ON `avaliacoes_db`.`respostas` (`valor_resposta` ASC) VISIBLE;

CREATE INDEX `idx_respostas_tipo_resposta` ON `avaliacoes_db`.`respostas` (`tipo_resposta` ASC) VISIBLE;

CREATE INDEX `idx_respostas_tipo_valor` ON `avaliacoes_db`.`respostas` (`tipo_resposta` ASC, `valor_resposta` ASC) VISIBLE;

CREATE FULLTEXT INDEX `idx_respostas_texto_resposta` ON `avaliacoes_db`.`respostas` (`texto_resposta`) VISIBLE;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
